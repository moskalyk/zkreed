{"ast":null,"code":"import { sortAll } from './utils.js';\nimport drain from 'it-drain';\nimport filter from 'it-filter';\nimport take from 'it-take';\nexport class BaseDatastore {\n  open() {\n    return Promise.reject(new Error('.open is not implemented'));\n  }\n\n  close() {\n    return Promise.reject(new Error('.close is not implemented'));\n  }\n\n  put(key, val, options) {\n    return Promise.reject(new Error('.put is not implemented'));\n  }\n\n  get(key, options) {\n    return Promise.reject(new Error('.get is not implemented'));\n  }\n\n  has(key, options) {\n    return Promise.reject(new Error('.has is not implemented'));\n  }\n\n  delete(key, options) {\n    return Promise.reject(new Error('.delete is not implemented'));\n  }\n\n  async *putMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const {\n      key,\n      value\n    } of source) {\n      await this.put(key, value, options);\n      yield {\n        key,\n        value\n      };\n    }\n  }\n\n  async *getMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const key of source) {\n      yield this.get(key, options);\n    }\n  }\n\n  async *deleteMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const key of source) {\n      await this.delete(key, options);\n      yield key;\n    }\n  }\n\n  batch() {\n    let puts = [];\n    let dels = [];\n    return {\n      put(key, value) {\n        puts.push({\n          key,\n          value\n        });\n      },\n\n      delete(key) {\n        dels.push(key);\n      },\n\n      commit: async options => {\n        await drain(this.putMany(puts, options));\n        puts = [];\n        await drain(this.deleteMany(dels, options));\n        dels = [];\n      }\n    };\n  }\n\n  async *_all(q, options) {\n    throw new Error('._all is not implemented');\n  }\n\n  async *_allKeys(q, options) {\n    throw new Error('._allKeys is not implemented');\n  }\n\n  query(q, options) {\n    let it = this._all(q, options);\n\n    if (q.prefix != null) {\n      it = filter(it, e => e.key.toString().startsWith(q.prefix));\n    }\n\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter(it, f), it);\n    }\n\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n\n    if (q.offset != null) {\n      let i = 0;\n      it = filter(it, () => i++ >= q.offset);\n    }\n\n    if (q.limit != null) {\n      it = take(it, q.limit);\n    }\n\n    return it;\n  }\n\n  queryKeys(q, options) {\n    let it = this._allKeys(q, options);\n\n    if (q.prefix != null) {\n      it = filter(it, key => key.toString().startsWith(q.prefix));\n    }\n\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter(it, f), it);\n    }\n\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n\n    if (q.offset != null) {\n      let i = 0;\n      it = filter(it, () => i++ >= q.offset);\n    }\n\n    if (q.limit != null) {\n      it = take(it, q.limit);\n    }\n\n    return it;\n  }\n\n}","map":{"version":3,"names":["sortAll","drain","filter","take","BaseDatastore","open","Promise","reject","Error","close","put","key","val","options","get","has","delete","putMany","source","value","getMany","deleteMany","batch","puts","dels","push","commit","_all","q","_allKeys","query","it","prefix","e","toString","startsWith","Array","isArray","filters","reduce","f","orders","offset","i","limit","queryKeys"],"sources":["/Users/mgrok/Projects/fluence-projects/examples/quickstart/1-browser-to-browser/node_modules/datastore-core/esm/src/base.js"],"sourcesContent":["import { sortAll } from './utils.js';\nimport drain from 'it-drain';\nimport filter from 'it-filter';\nimport take from 'it-take';\nexport class BaseDatastore {\n  open() {\n    return Promise.reject(new Error('.open is not implemented'));\n  }\n  close() {\n    return Promise.reject(new Error('.close is not implemented'));\n  }\n  put(key, val, options) {\n    return Promise.reject(new Error('.put is not implemented'));\n  }\n  get(key, options) {\n    return Promise.reject(new Error('.get is not implemented'));\n  }\n  has(key, options) {\n    return Promise.reject(new Error('.has is not implemented'));\n  }\n  delete(key, options) {\n    return Promise.reject(new Error('.delete is not implemented'));\n  }\n  async *putMany(source, options = {}) {\n    for await (const {key, value} of source) {\n      await this.put(key, value, options);\n      yield {\n        key,\n        value\n      };\n    }\n  }\n  async *getMany(source, options = {}) {\n    for await (const key of source) {\n      yield this.get(key, options);\n    }\n  }\n  async *deleteMany(source, options = {}) {\n    for await (const key of source) {\n      await this.delete(key, options);\n      yield key;\n    }\n  }\n  batch() {\n    let puts = [];\n    let dels = [];\n    return {\n      put(key, value) {\n        puts.push({\n          key,\n          value\n        });\n      },\n      delete(key) {\n        dels.push(key);\n      },\n      commit: async options => {\n        await drain(this.putMany(puts, options));\n        puts = [];\n        await drain(this.deleteMany(dels, options));\n        dels = [];\n      }\n    };\n  }\n  async *_all(q, options) {\n    throw new Error('._all is not implemented');\n  }\n  async *_allKeys(q, options) {\n    throw new Error('._allKeys is not implemented');\n  }\n  query(q, options) {\n    let it = this._all(q, options);\n    if (q.prefix != null) {\n      it = filter(it, e => e.key.toString().startsWith(q.prefix));\n    }\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter(it, f), it);\n    }\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n    if (q.offset != null) {\n      let i = 0;\n      it = filter(it, () => i++ >= q.offset);\n    }\n    if (q.limit != null) {\n      it = take(it, q.limit);\n    }\n    return it;\n  }\n  queryKeys(q, options) {\n    let it = this._allKeys(q, options);\n    if (q.prefix != null) {\n      it = filter(it, key => key.toString().startsWith(q.prefix));\n    }\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter(it, f), it);\n    }\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n    if (q.offset != null) {\n      let i = 0;\n      it = filter(it, () => i++ >= q.offset);\n    }\n    if (q.limit != null) {\n      it = take(it, q.limit);\n    }\n    return it;\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}